# .github/workflows/data_collection.yml

name: Scheduled Crypto Data Collection

on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

  # Runs the workflow on a schedule
  schedule:
    # Runs every 15 minutes
    - cron: '*/15 * * * *'

jobs:
  collect-data:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checks out your repository's code
      - name: Check out repository
        uses: actions/checkout@v4

      # Step 2: Sets up the Python environment
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # Step 3: Installs Python dependencies from your requirements.txt file
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Step 4: Runs your data collection script with secrets as environment variables
      - name: Run Data Collection Script
        env:
          COINMARKETCAP_API_KEY: ${{ secrets.COINMARKETCAP_API_KEY }}
          SUPABASE_DB_URL: ${{ secrets.SUPABASE_DB_URL }}
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_HOST: ${{ secrets.DB_PORT }}
          DB_USER: ${{ secrets.DB_USER }}
          DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
          DB_NAME: ${{ secrets.DB_NAME }}
        run: |
          python -m src.collect_data BTC ETH BNB USDT SOL XRP USDC ADA DOGE TON AVAX SHIB DOT TRX WBTC LINK MATIC NEAR LTC BCH ICP DAI UNI ETC LEO STETH XMR OKB FIL CRO APT LDO INJ RUNE ARB HBAR MKR QNT AAVE SUI OP XLM ENS GRT AXS FLOW KAS XTZ SNX EOS --max-rows 200
